<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FullCalendar Example with Conflicts</title>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
    <link
      href="https://unpkg.com/@fullcalendar/core/main.css"
      rel="stylesheet"
    />
    <link
      href="https://unpkg.com/@fullcalendar/daygrid/main.css"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/@fullcalendar/core/main.js"></script>
    <script src="https://unpkg.com/@fullcalendar/daygrid/main.js"></script>
    <link rel="stylesheet" href="calendar.css" />
    <link rel="stylesheet" href="modal.css" />
  </head>
  <body>
    <div id="calendar"></div>
    <div id="eventModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2 id="eventTitle"></h2>
        <p id="eventDetails"></p>
        <button id="editButton">Edit</button>
        <button id="deleteButton">Delete</button>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const calendarEl = document.getElementById("calendar");

        let events = [
          {
            title: "Meeting 1",
            start: "2024-10-21T10:30:00",
            end: "2024-10-21T12:30:00",
            id: "1",
            classNames: ['fc-event-1']
          },
          {
            title: "Meeting 2",
            start: "2024-10-21T11:30:00",
            end: "2024-10-21T12:00:00",
            id: "2",
            classNames: ['fc-event-2']
          },
          {
            title: "Meeting 3",
            start: "2024-10-21T13:00:00",
            end: "2024-10-21T14:00:00",
            id: "3",
            classNames: ['fc-event-2']
          },
        ];

        // Function to check for conflicts
        function checkConflict(event1, event2) {
          return event1.start < event2.end && event1.end > event2.start;
        }

        // Function to highlight conflicting events
        function highlightConflicts(events) {
          const conflictEvents = [];
          for (let i = 0; i < events.length; i++) {
            for (let j = i + 1; j < events.length; j++) {
              if (checkConflict(events[i], events[j])) {
                console.log(
                  `Conflict detected between: ${events[i].title} and ${events[j].title}`
                );
                conflictEvents.push(events[i]);
                conflictEvents.push(events[j]);
              }
            }
          }
          return conflictEvents;
        }

        // Log the events before processing
        console.log("Events:", events);
        const conflictEvents = highlightConflicts(events);
        const conflictEventIds = new Set(
          conflictEvents.map((event) => event.id)
        );
        console.log("Conflict Event IDs:", Array.from(conflictEventIds));

        const modal = document.getElementById("eventModal");
        const eventTitle = document.getElementById("eventTitle");
        const eventDetails = document.getElementById("eventDetails");
        const closeBtn = document.querySelector(".close");

        const calendar = new FullCalendar.Calendar(calendarEl, {
          initialView: "dayGridMonth",
          events: events,
          eventDidMount: function (info) {
            const isConflict = conflictEventIds.has(info.event.id);
            if (isConflict) {
              // Apply background and border colors directly to the event element
              info.el.style.color = "red";
              info.el.style.border = "2px solid red";
            }

            info.el.addEventListener("click", () => {
              // Show the modal and set event details
              modal.style.display = "block";
              eventTitle.textContent = info.event.title;

              // Load additional schedule data into the modal
              const start = info.event.start.toLocaleString(); // Format start date
              const end = info.event.end
                ? info.event.end.toLocaleString()
                : "N/A"; // Format end date
              eventDetails.textContent = `Start: ${start}\nEnd: ${end}`;

              // Optionally store event ID for edit/delete operations
              const eventId = info.event.id;
              setEditDeleteButtons(eventId);
            });
          },
          eventContent: function (arg) {
            const startTime = arg.event.start.toLocaleTimeString([], {
              hour: "2-digit",
              minute: "2-digit",
            });
            const endTime = arg.event.end
              ? arg.event.end.toLocaleTimeString([], {
                  hour: "2-digit",
                  minute: "2-digit",
                })
              : "";
            return { html: `${startTime} - ${endTime} ${arg.event.title}` };
          },
        });

        // Function to set edit/delete button logic
        function setEditDeleteButtons(eventId) {
          document.getElementById("editButton").onclick = () => {
            alert(`Editing event with ID: ${eventId}`);
            // Add logic to edit the event (e.g., open a form or redirect to an edit page)
          };

          document.getElementById("deleteButton").onclick = () => {
            if (confirm("Are you sure you want to delete this event?")) {
              const eventToDelete = calendar.getEventById(eventId);
              if (eventToDelete) {
                eventToDelete.remove(); // Remove the event from the calendar
              }
              modal.style.display = "none"; // Close the modal
            }
          };
        }

        // Close the modal when clicking the "x" button
        closeBtn.addEventListener("click", () => {
          modal.style.display = "none";
        });

        // Close the modal when clicking outside of the modal content
        window.addEventListener("click", (event) => {
          if (event.target === modal) {
            modal.style.display = "none";
          }
        });

        calendar.render(); // Render the calendar
      });
    </script>
  </body>
</html>
